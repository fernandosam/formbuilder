NumberFormat=Class.create({initialize:function(e,t){this.el=$(e);var t=Object.extend({prefix:"US$ ",centsSeparator:".",thousandsSeparator:",",limit:false,centsLimit:2,clearPrefix:false,allowNegative:false,clearOnEmpty:false},t);this.is_number=/[0-9]/;this.prefix=t.prefix;this.centsSeparator=t.centsSeparator;this.thousandsSeparator=t.thousandsSeparator;this.limit=t.limit;this.centsLimit=t.centsLimit;this.clearPrefix=t.clearPrefix;this.allowNegative=t.allowNegative;this.clearOnEmpty=t.clearOnEmpty;if(this.clearPrefix){Event.observe(this.el,"blur",this.clearPrefix.bind(this));Event.observe(this.el,"focus",this.addPrefix.bind(this))}Event.observe(this.el,"keyup",this.priceIt.bind(this));Event.observe(this.el,"keydown",this.keyCheck.bind(this));if(this.el.value.length>0){this.priceIt();this.clearPrefix()}},keyCheck:function(e){var t=e.keyCode?e.keyCode:e.which;var n=String.fromCharCode(t);var r=false;var i=e.target.value;var s=this.priceFormat(i+n);if(t>=48&&t<=57||t>=96&&t<=105)r=true;if(t==8)r=true;if(t==9)r=true;if(t==13)r=true;if(t==46)r=true;if(t==35)r=true;if(t==36)r=true;if(t==37)r=true;if(t==39)r=true;if(this.allowNegative&&(t==189||t==109))r=true;if(!r){e.preventDefault();e.stopPropagation();if(i!=s)e.target.value=s}},toNumbers:function(e){var t="";for(var n=0;n<e.length;n++){char=e.charAt(n);if(t.length==0&&char==0)char=false;if(char&&char.match(this.is_number)){if(this.limit){if(t.length<this.limit)t=t+char}else{t=t+char}}}return t},priceFormat:function(e,t){if(!t&&(e===""||e==this.priceFormat("0",true))&&clearOnEmpty){return""}var n=this.fillWithZeroes(this.toNumbers(e));var r="";var i=0;var s=n.substr(n.length-this.centsLimit,this.centsLimit);var o=n.substr(0,n.length-this.centsLimit);n=o+this.centsSeparator+s;if(this.thousandsSeparator){for(var u=o.length;u>0;u--){char=o.substr(u-1,1);i++;if(i%3==0)char=this.thousandsSeparator+char;r=char+r}if(r.substr(0,1)==this.thousandsSeparator)r=r.substring(1,r.length);n=r+this.centsSeparator+s}if(this.allowNegative&&e.indexOf("-")!=-1&&(o!=0||s!=0))n="-"+n;if(this.prefix){n=this.prefix+n}return n},fillWithZeroes:function(e){while(e.length<this.centsLimit+1){e="0"+e}return e},priceIt:function(){var e=this.el.value;var t=this.priceFormat(e);if(e!=t){this.el.value=t}},addPrefix:function(){var e=el.value;el.value=this.prefix+e},clearPrefix:function(){if(prefix.trim()!=""&&this.clearPrefix){var e=el.value.split(this.prefix);el.value=e[1]}}})